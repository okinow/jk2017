/* Copyright (c) 2014 TreSensa, Inc. All Rights Reserved. */
setTimeout(function(){for(var a,b=document.getElementsByTagName("script"),c=/\.tresensa\.com(:\d+)?\/embed\.js/,d=0;d<b.length;d++)if(c.test(b[d].getAttribute("src"))){a=b[d];break}if(!a)throw"Unable to locate Tresensa embed tag. It must be laoded from sdk.tresensa.com/embed.js";var e=a.getAttribute("data-fullscreen"),f=a.getAttribute("data-fullscreen-mobile"),g=a.getAttribute("data-fullscreen-desktop"),h=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),i="true"==((h?f:g)||e),j=/Firefox/i.test(navigator.userAgent)&&(/Android/i.test(navigator.userAgent)||/Mobile/i.test(navigator.userAgent)),k=a.getAttribute("data-width"),l=a.getAttribute("data-height"),m=a.getAttribute("data-game"),n=a.getAttribute("data-version"),o=a.getAttribute("data-host")||"games.tresensa.com",p="false"!=a.getAttribute("data-autoplay"),q=a.getAttribute("data-params"),r=a.getAttribute("data-class")||"",s=!!a.getAttribute("data-poster-image"),t=a.getAttribute("data-poster-image")||"http://games.tresensa.com/"+m+"/banners/448x252.png",u="true"==a.getAttribute("data-closeable"),v=a.getAttribute("data-ignore-orientation")?"true"==a.getAttribute("data-ignore-orientation"):!i,w=0===a.getAttribute("src").indexOf("https:")||0===a.getAttribute("src").indexOf("//")&&"https:"===location.protocol?"https:":"http:";window.TresensaEmbed={};var x,y,z=document.querySelector("meta[name='viewport']"),A={viewport:"",minHeight:0,minWidth:0},B=function(a,b){b=b||0;var c=document.createElement("iframe");c.src=w+"//"+o+"/"+m+"/"+(n?n+"/":"")+"?ignoreOrientation="+v+(q?"&"+q:"")+(window.tresensa_embed_params?"&"+window.tresensa_embed_params:""),c.scrolling="no",c.style.border="none","100%"==k?(c.style.width="10px",c.style.minWidth="100%"):c.width=k,"100%"==l?(c.style.height="10px",c.style.minHeight="100%"):c.height=l,c.setAttribute("class",r),a.appendChild(c),TresensaEmbed.postMessage=function(a){c.contentWindow.postMessage(JSON.stringify(a),"*")},TresensaEmbed.pauseGame=function(){TresensaEmbed.postMessage("iframe:pause")},TresensaEmbed.resizeGame=function(){TresensaEmbed.postMessage("iframe:resize")},TresensaEmbed.proxyEvent=function(a,b,c){(c||window).addEventListener(a,function(){TresensaEmbed.pauseGame()},!1)},TresensaEmbed.proxyEvent("pagehide","iframe:pause"),i&&(z?A.viewport=z.getAttribute("content"):(z=document.createElement("meta"),z.setAttribute("name","viewport"),document.getElementsByTagName("head")[0].appendChild(z)),z.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui"),x=function(){c.width=a.style.width=window.innerWidth+"px",a.style.height=window.innerHeight+"px",c.height=window.innerHeight-b+"px";var d=a.offsetTop||1,e=a.offsetLeft;(window.scrollY!=d||window.scrollX!=e)&&window.scrollTo(e,d),TresensaEmbed.resizeGame(window.innerWidth,window.innerHeight)},y=function(){if(j){var a=z.parentNode;a.removeChild(z),a.appendChild(z)}},window.addEventListener("resize",x),window.addEventListener("orientationchange",y),window.addEventListener("orientationchange",x),window.addEventListener("scroll",x),A.minHeight=document.body.style.minHeight,A.minWidth=document.body.style.minWidth,document.body.style.minHeight="5000px",document.body.style.minWidth="5000px",b&&(A.overflow=document.body.style.overflow,A.margin=document.body.style.margin,A.padding=document.body.style.padding,document.body.style.overflow="hidden",document.body.style.margin=0,document.body.style.padding=0),setTimeout(x,200))},C=document.createElement("div");if(C.setAttribute("class","tresensa-embed"),C.setAttribute("style","overflow: hidden; position: relative; top: 1px; width: "+k+"; height: "+l+";"),a.parentNode.insertBefore(C,a),p)B(C);else{var D=document.createElement("div");D.innerHTML=["<img style='width: 100%; vertical-align: middle;' src='"+t+"'/>","<div style='display: inline-block; height: 100%; vertical-align: middle;'></div>","<div style='position: absolute; top: 0; left: 0; width: 100%; height: 100%; margin: auto;",s?"":" background: rgba(255,255,255,0.35);","'>",s?"":"<img src='//sdk.tresensa.com/embed-play.png' style='display: block; width: 100px; margin: auto; position: relative; top: 50%; margin-top: -50px;'/>","</div>"].join(""),D.setAttribute("style","background: black; cursor: pointer; position: absolute; background: black; top: 0; left: 0; width: 100%; height: 100%;"),TresensaEmbed.play=function(){if(u){var a=document.createElement("div");a.setAttribute("class","tresensa-embed tresensa-fullscreen"),a.setAttribute("style","overflow: hidden; position: relative; top: 1px; width: "+k+"; height: "+l+"; background: black; z-index: 10000;"),document.body.appendChild(a);var b=document.createElement("div");b.setAttribute("class","tresensa-modal-bar"),b.setAttribute("style","position: absolute; width: 100%; height: 50px; bottom: 0; left: 0; background: #333;"),b.addEventListener("touchmove",function(a){a.stopPropagation(),a.preventDefault()});var c=document.createElement("div");c.setAttribute("class","tresensa-modal-fs-drag"),c.setAttribute("style","position: absolute; height: 49px; bottom: 0; left: 0; right: 50px; color: white; text-align: center; line-height: 49px; background: black; font-family: 'Helvetica'; font-size: 15px;"),b.appendChild(c);var d=document.createElement("div");d.setAttribute("class","tresensa-modal-close"),d.setAttribute("style","cursor: pointer; position: absolute; height: 49px; width: 50px; bottom: 0; right: 0; color: white; text-align: center; line-height: 49px; background: black url(//sdk.tresensa.com/embed-close.png) no-repeat center center; background-size: 20px 20px;"),d.addEventListener("click",function(){window.removeEventListener("resize",x),window.removeEventListener("orientationchange",y),window.removeEventListener("orientationchange",x),window.removeEventListener("scroll",x),document.body.style.minHeight=A.minHeight,document.body.style.minWidth=A.minWidth,document.body.style.overflow=A.overflow,document.body.style.margin=A.margin,document.body.style.padding=A.padding,z.setAttribute("content",A.viewport),a.parentNode.removeChild(a)}),b.appendChild(d),a.appendChild(b),B(a,50)}else B(C),D.removeEventListener("click",TresensaEmbed.play),D.parentNode.removeChild(D)},D.addEventListener("click",TresensaEmbed.play),C.appendChild(D)}},0);